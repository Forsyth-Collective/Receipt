<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Receipt Generator</title>

<!-- External Libraries -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ---------- General Styles ---------- */
body {font-family: Arial,sans-serif; background:#f0f2f5; margin:0; padding:20px;}
h1,h2,h3,h4,h5,h6 {margin:0;}
.container {display:flex; flex-wrap:wrap; gap:20px; max-width:1200px; margin:0 auto;}
.card {background:#fff; border-radius:12px; padding:20px; box-shadow:0 8px 28px rgba(0,0,0,0.05); flex:1;}
label {display:block; font-size:13px; margin-top:10px;}
input[type=text], input[type=email], input[type=tel], input[type=number], select, textarea {width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; margin-top:4px;}
button {cursor:pointer; border:none; border-radius:8px; padding:8px 12px; margin-top:8px;}
button.primary {background:#1f6feb; color:#fff;}
button.delete {background:red; color:#fff; font-size:12px; padding:2px 6px; position:absolute; top:4px; right:4px;}
.item-row {display:grid; grid-template-columns:1fr 80px 100px 100px; gap:8px; align-items:center; margin-top:6px; position:relative;}
.item-row input {width:100%;}

/* ---------- Image thumbnails ---------- */
.thumb-grid {display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;}
.thumb {position:relative; width:80px; height:60px; border:1px solid #ccc; border-radius:8px; overflow:hidden;}
.thumb img {width:100%; height:100%; object-fit:cover;}
.thumb button {position:absolute; top:2px; right:2px;}

/* ---------- Signature ---------- */
canvas {border:1px solid #ccc; border-radius:8px; width:100%; height:100px;}

/* ---------- PDF Layout ---------- */
.receipt {width:210mm; min-height:297mm; background:#fff; padding:20mm; box-sizing:border-box; font-size:13px; margin:0 auto; color:#000;}
.receipt header {display:flex; justify-content:space-between;}
.receipt h2 {margin-bottom:6px;}
.line-items {margin-top:12px;}
.line-items table {width:100%; border-collapse:collapse;}
.line-items th, .line-items td {border:1px solid #ccc; padding:6px;}
.right {text-align:right;}
.sig-line {border-bottom:1px solid #000; width:200px; text-align:center; margin-top:40px; font-size:12px;}
.footer-vat {text-align:center; margin-top:12px; font-weight:bold;}
</style>
</head>
<body>

<div class="container">

<!-- Left Form Card -->
<div class="card">
<h2>Seller & Buyer Information</h2>

<form id="receiptForm">

<!-- Seller -->
<h3>Seller</h3>
<label>First Name<input type="text" id="seller_first"></label>
<label>Last Name<input type="text" id="seller_last"></label>
<label>Property Number/Name<input type="text" id="seller_prop"></label>
<label>Company<input type="text" id="seller_company"></label>
<label>Address Line 1<input type="text" id="seller_addr1"></label>
<label>Address Line 2<input type="text" id="seller_addr2"></label>
<label>Town<input type="text" id="seller_town"></label>
<label>County<input type="text" id="seller_county"></label>
<label>Post Code<input type="text" id="seller_post"></label>
<label>Country<input type="text" id="seller_country"></label>
<label>Telephone<input type="tel" id="seller_tel"></label>
<label>Email<input type="email" id="seller_email"></label>

<!-- Buyer -->
<h3>Buyer</h3>
<label>First Name<input type="text" id="buyer_first"></label>
<label>Last Name<input type="text" id="buyer_last"></label>
<label>Property Number/Name<input type="text" id="buyer_prop"></label>
<label>Company<input type="text" id="buyer_company"></label>
<label>Address Line 1<input type="text" id="buyer_addr1"></label>
<label>Address Line 2<input type="text" id="buyer_addr2"></label>
<label>Town<input type="text" id="buyer_town"></label>
<label>County<input type="text" id="buyer_county"></label>
<label>Post Code<input type="text" id="buyer_post"></label>
<label>Country<input type="text" id="buyer_country"></label>
<label>Telephone<input type="tel" id="buyer_tel"></label>
<label>Email<input type="email" id="buyer_email"></label>

<!-- Purchase Details -->
<h3>Purchase Details</h3>
<label>Online Site<input type="text" id="online_site"></label>
<label>Type
<select id="purchase_type">
<option value="item">Item</option>
<option value="service">Service</option>
</select>
</label>

<!-- Item Quantity -->
<label>Number of Items/Services
<select id="num_items"></select>
</label>

<div id="items_container"></div>

<!-- VAT -->
<label><input type="checkbox" id="vat_registered"> VAT Registered</label>
<label>VAT Number<input type="text" id="vat_number" placeholder="Enter VAT Number"></label>
<label>VAT Rate (%)<input type="number" id="vat_rate" value="20"></label>

<!-- Signatures -->
<h3>Signatures</h3>
<label>Seller Signature</label>
<canvas id="sig_seller"></canvas>
<button type="button" onclick="clearSig('seller')">Clear</button>

<label>Buyer Signature</label>
<canvas id="sig_buyer"></canvas>
<button type="button" onclick="clearSig('buyer')">Clear</button>

<button type="button" class="primary" onclick="generatePDF()">Generate PDF</button>

</form>
</div>
</div>

<script>
// ---------- Dynamic item rows ----------
const numItemsSelect = document.getElementById('num_items');
for(let i=1;i<=10;i++){
    let opt=document.createElement('option'); opt.value=i; opt.text=i; numItemsSelect.appendChild(opt);
}
const itemsContainer = document.getElementById('items_container');
numItemsSelect.addEventListener('change',renderItems);
document.getElementById('purchase_type').addEventListener('change',renderItems);

function renderItems(){
    itemsContainer.innerHTML='';
    let num = parseInt(numItemsSelect.value);
    let type = document.getElementById('purchase_type').value;
    for(let i=1;i<=num;i++){
        let div = document.createElement('div'); div.className='item-row';
        div.innerHTML=`
        <input type="text" placeholder="${type} Name">
        <input type="number" placeholder="Quantity" value="1" min="1">
        <input type="number" placeholder="Cost (£)" value="0">
        <input type="text" placeholder="Description">
        `;
        itemsContainer.appendChild(div);
    }
}
renderItems();

// ---------- Signature ----------
let sigSeller = new SignaturePad(document.getElementById('sig_seller'));
let sigBuyer = new SignaturePad(document.getElementById('sig_buyer'));
function clearSig(who){if(who==='seller')sigSeller.clear(); else sigBuyer.clear();}

// ---------- PDF Generation ----------
async function generatePDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({unit:'mm', format:'a4'});
    const pageWidth = 210; const margin=20;

    // Seller / Buyer Info
    doc.setFontSize(12);
    doc.text('Seller:',margin,20);
    doc.text('Buyer:',pageWidth/2,20);
    let sellerName = document.getElementById('seller_first').value + ' ' + document.getElementById('seller_last').value;
    let buyerName = document.getElementById('buyer_first').value + ' ' + document.getElementById('buyer_last').value;
    doc.text(sellerName,margin,28);
    doc.text(buyerName,pageWidth/2,28);
    doc.text('Email: '+document.getElementById('seller_email').value,margin,34);
    doc.text('Email: '+document.getElementById('buyer_email').value,pageWidth/2,34);

    // Items Table
    const items = itemsContainer.querySelectorAll('.item-row');
    let startY=50;
    doc.setFontSize(12);
    doc.text('Items/Services:',margin,startY);
    startY+=6;
    doc.autoTable({ startY:startY, head:[['Name','Qty','Cost (£)','Description']], body: Array.from(items).map(r=>{
        return [r.children[0].value,r.children[1].value,r.children[2].value,r.children[3].value];
    })});
    
    // VAT Footer
    const vatRegistered=document.getElementById('vat_registered').checked;
    if(vatRegistered){
        let vatNum = document.getElementById('vat_number').value;
        doc.setFontSize(12);
        doc.text('VAT Number: '+vatNum,pageWidth/2,290,{align:'center'});
    }

    // Signatures
    const sigSellerImg = sigSeller.toDataURL();
    const sigBuyerImg = sigBuyer.toDataURL();
    doc.addImage(sigSellerImg,'PNG',margin,200,80,30);
    doc.text('Seller Signature',margin,235);
    doc.addImage(sigBuyerImg,'PNG',pageWidth/2,200,80,30);
    doc.text('Buyer Signature',pageWidth/2,235);

    doc.save('receipt.pdf');
}
</script>
</body>
</html>
